<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Details of `stormwindmodel` package • stormwindmodel</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Details of `stormwindmodel` package">
<meta property="og:description" content="stormwindmodel">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stormwindmodel</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.5.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Details.html">Details of `stormwindmodel` package</a>
    </li>
    <li>
      <a href="../articles/Overview.html">Using the `stormwindmodel` package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/geanders/stormwindmodel/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Details of <code>stormwindmodel</code> package</h1>
                        <h4 data-toc-skip class="author">G. Brooke Anderson, Andrea Schumacher, Seth Guikema, Joshua M. Ferreri, Steven Quiring</h4>
            
            <h4 data-toc-skip class="date">2022-03-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/geanders/stormwindmodel/blob/HEAD/vignettes/Details.Rmd" class="external-link"><code>vignettes/Details.Rmd</code></a></small>
      <div class="hidden name"><code>Details.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="overview-of-wind-modeling-process">Overview of wind modeling process<a class="anchor" aria-label="anchor" href="#overview-of-wind-modeling-process"></a>
</h3>
<p>Here is an overview of the wind modeling process implemented by this package:</p>
<ol style="list-style-type: decimal">
<li>Impute location and maximum wind speed from hurricane track data (every 6 hours) to more frequent intervals. The default is to impute to every 15 minutes.</li>
<li>For each storm track location, calculate all the inputs needed for the Willoughby wind speed model (forward speed, direction of forward motion of the storm, gradient-level wind speed, radius of maximum winds, parameters for decay of winds away from the storm’s center for Willoughby model) <span class="citation">(Willoughby, Darling, and Rahn 2006)</span>.</li>
<li>For each county center (or other grid point), estimate surface-level sustained wind and 3-second wind gusts at all storm observation points (i.e., all points along the interpolated storm track). This step includes: measuring distance to county from storm center (radius); calculating tangential gradient wind components at that grid point; calculating gradient wind direction at that grid point; calculating surface wind speed; calculating surface wind direction, adding storm forward motion back into surface wind estimate.</li>
<li>Determine for each county: the maximum sustained winds and wind gust speeds at any point on the storm’s track; the duration of sustained and gust winds over a certain speed (i.e., how many minutes winds were above a cutoff).</li>
</ol>
<p>This process is conducted in the <code>stormwindmodel</code> package using three main functions: <code>create_full_track</code>, <code>add_wind_radii</code>, and <code>calc_grid_wind</code>. Each of these functions has a number of helper functions to do each required modeling step. Details of all of these are included in this vignette. The full process is then wrapped in the <code>get_grid_winds</code> function, which is the main function most people will use from this package.</p>
</div>
<div class="section level3">
<h3 id="variable-definitions">Variable definitions<a class="anchor" aria-label="anchor" href="#variable-definitions"></a>
</h3>
<p>Here are variables used in this modeling process.</p>
</div>
<div class="section level3">
<h3 id="impute-storm-tracks">Impute storm tracks<a class="anchor" aria-label="anchor" href="#impute-storm-tracks"></a>
</h3>
<p>The tropical cyclone best tracks have observations every six hours (plus, for some, an observation at landfall). Our package has a function called <code>create_full_track</code> that imputes both locations (latitude and longitude) and intensity (maximum wind speed) from the hurricane tracks data to a finer time resolution (default is 15 minutes, but you can also select other values using the <code>tint</code> argument). This imputation uses a natural cubic spline, with the degrees of freedom set as the number of timed observations for the storm in the input data (typically best tracks data) divided by two. The option <code>tint</code> in this function gives the time interval you want to use, in hours (e.g., 0.25 for 15 minutes).</p>
<p>Note: This code assumes that the tracking data read has been measured in knots, at 10 m above surface level, and taken at a 1-minute average period.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">::</span><span class="va"><a href="../reference/create_full_track.html">create_full_track</a></span></code></pre></div>
<p>Here is an example of running this function, where <code>floyd_tracks</code> is a dataframe with the hurricane track information for Hurricane Floyd (saved as data with this package), and <code>tint</code> is the desired time interval to which to impute:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"floyd_tracks"</span><span class="op">)</span>
<span class="va">full_track</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_full_track.html">create_full_track</a></span><span class="op">(</span>hurr_track <span class="op">=</span> <span class="va">floyd_tracks</span>, tint <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span>
<span class="va">full_track</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<p>Here is an example of interpolating Hurricane Floyd’s tracks to 15-minute and 2-hour intervals</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">maps</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>

<span class="va">floyd_states</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="st">"state"</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"north carolina"</span>, <span class="st">"south carolina"</span>, <span class="st">"maryland"</span>,
                          <span class="st">"georgia"</span>, <span class="st">"florida"</span>, <span class="st">"virginia"</span>, <span class="st">"delaware"</span>, 
                          <span class="st">"pennsylvania"</span>, <span class="st">"west virginia"</span>, <span class="st">"new jersey"</span>,
                          <span class="st">"new york"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">floyd_15_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_full_track.html">create_full_track</a></span><span class="op">(</span><span class="va">floyd_tracks</span><span class="op">)</span>
<span class="va">floyd_2_hrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_full_track.html">create_full_track</a></span><span class="op">(</span><span class="va">floyd_tracks</span>, tint <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">floyd_15_min</span> <span class="op">&lt;-</span> <span class="va">floyd_15_min</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tclon"</span>, <span class="st">"tclat"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_set_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span>
<span class="va">floyd_2_hrs</span> <span class="op">&lt;-</span> <span class="va">floyd_2_hrs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tclon"</span>, <span class="st">"tclat"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_set_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span>

<span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">floyd_states</span>, 
          fill <span class="op">=</span> <span class="st">"aliceblue"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">90</span>, <span class="op">-</span><span class="fl">70</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">24</span>, <span class="fl">46</span><span class="op">)</span><span class="op">)</span>
<span class="va">b</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">floyd_15_min</span>,
          size <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Interpolated to 15 minutes"</span><span class="op">)</span>
<span class="va">c</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">floyd_2_hrs</span>,
            size <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Interpolated to 2 hours"</span><span class="op">)</span> 

<span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">b</span>, <span class="va">c</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>The function includes a correction in case the storm tracks cross the International Date line. In this case, the longitude might change from close to -180 to close to 180, or vice versa. The track interpolation checks for large differences in longitude that might happen in this case. If there are such changes, then the function brings all the longitudes into a similar range, to avoid problems with interpolation across the International Date line. After interpolation, all longitudes are brought to be between -180 and 180. Here is the code in the <code>create_full_track</code> function that adjusts for storm tracks that have large differences in longitude, and so likely cross the International Date line:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="co"># Identify cases where a storm goes over the international date line, and</span>
  <span class="co"># longitudes change from about 180 to about -180, or vice versa. Correct this</span>
  <span class="co"># before interpolating (then later we get everything back within the 180 to -180</span>
  <span class="co"># range).</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">hurr_track</span><span class="op">$</span><span class="va">tclon</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">300</span><span class="op">)</span><span class="op">{</span>
    <span class="va">hurr_track</span> <span class="op">&lt;-</span> <span class="va">hurr_track</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>tclon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">tclon</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="va">tclon</span>, <span class="va">tclon</span> <span class="op">+</span> <span class="fl">360</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span></code></pre></div>
<p>Here is the code in the <code>create_full_track</code> function that ensures the output location data remain within -180 to 180 for longitude:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="co"># Make sure that longitude is between -180 and 180</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>tclon <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="va">tclon</span> <span class="op">+</span> <span class="fl">180</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">360</span><span class="op">)</span> <span class="op">-</span> <span class="fl">180</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="add-willoughby-inputs-and-parameters">Add Willoughby inputs and parameters<a class="anchor" aria-label="anchor" href="#add-willoughby-inputs-and-parameters"></a>
</h3>
<p>Next, this imputed track is input to a function that adds inputs and model parameters for each observation that are required for the model later used to estimate wind speed at each grid point <span class="citation">(Willoughby, Darling, and Rahn 2006)</span>. This process is done using the <code>add_wind_radii</code> function. For the Hurricane Floyd example, here is an example of running the code and the first three and last three line of output:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/geanders/stormwindmodel" class="external-link">stormwindmodel</a></span><span class="op">)</span>
<span class="va">with_wind_radii</span> <span class="op">&lt;-</span> <span class="fu">stormwindmodel</span><span class="fu">::</span><span class="fu"><a href="../reference/add_wind_radii.html">add_wind_radii</a></span><span class="op">(</span>full_track <span class="op">=</span> <span class="va">full_track</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">with_wind_radii</span>, file <span class="op">=</span> <span class="st">"data/with_wind_radii.RData"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"data/with_wind_radii.RData"</span><span class="op">)</span>
<span class="va">with_wind_radii</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fl">3</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Here is an example of Hurricane Floyd tracks, with estimated <span class="math inline">\(R_{max}\)</span> and <span class="math inline">\(V_{max,G}\)</span> shown by point size and color, respectively:</p>
<p>The last line of observations has some missing values, because you need points after the current point to calculate forward speed and bearing of the storm, so these values cannot be calculated for the last observation.</p>
<p>Here is the full code for the <code>add_wind_radii</code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">::</span><span class="va"><a href="../reference/add_wind_radii.html">add_wind_radii</a></span></code></pre></div>
<p>This function uses many helper functions, which do each step of the process to calculate inputs and parameters for the wind model. These helper functions are fully described below.</p>
<div class="section level4">
<h4 id="calculate-the-storms-forward-speed">Calculate the storm’s forward speed<a class="anchor" aria-label="anchor" href="#calculate-the-storms-forward-speed"></a>
</h4>
<p>First, the code determines the forward speed of the storm at each observation, in meters per second. The forward speed of the storm needs to be removed from the observed maximum wind speed to get an estimate of the maximum wind speed associated just with the rotational movement of the storm, which is what needs to go into the Willoughby model <span class="citation">(Willoughby, Darling, and Rahn 2006)</span>. This asymmetry needs to be removed before we convert winds to gradient level. The code adds back in a forward motion component to the surface winds at grid points near the end of the the modeling process.</p>
<p>The code uses the Haversine method with great circle distance to calculate the distance, in kilometers, between the storm’s latitude and longitude coordinates for the current observation and the following observation. Then the time difference is determined between those two observations. From these, the storm’s forward speed is calculated. This speed is converted to meters per second (from kilometers per hour), so it’s in the same units as <span class="math inline">\(V_{max}\)</span> from the imputed storm tracks.</p>
<p>Here is the equation used in the code for the Haversine method with great circle distance to calculate the distance between two locations based on their latitudes and longitude:</p>
<p><span class="math display">\[
hav(\gamma) = hav(\phi_1 - \phi_2) + cos(\phi_1)*cos(\phi_2)*hav(L_1 - L_2)
\]</span> <span class="math display">\[
D = R_{earth} * \gamma 
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\phi_{1,rad}\)</span>: Latitude of first location, in radians</li>
<li>
<span class="math inline">\(L_{1,rad}\)</span>: Longitude of first location, in radians</li>
<li>
<span class="math inline">\(\phi_{2,rad}\)</span>: Latitude of second location, in radians</li>
<li>
<span class="math inline">\(L_{2,rad}\)</span>: Longitude of second location, in radians</li>
<li>
<span class="math inline">\(\gamma\)</span>: Intermediary result</li>
<li>
<span class="math inline">\(hav(\gamma)\)</span>: The haversine function, <span class="math inline">\(hav(\gamma) = sin^2 \left(\frac{\gamma}{2}\right)\)</span>
</li>
<li>
<span class="math inline">\(R_{earth}\)</span>: Radius of the earth, here assumed to be 6378.14 kilometers</li>
<li>
<span class="math inline">\(D\)</span>: Distance between the two locations, in kilometers</li>
</ul>
<p>In the package, there is a helper function to convert between degrees and radians (<code>degrees_to_radians</code>), as well as a function called <code>latlon_to_km</code> that uses the Haversine method to calculate the distance between two storm center locations (<code>tclat_1</code> and <code>tclat_2</code> are the two storm center latitudes; <code>tclon_1</code> and <code>tclon_2</code> are the two storm center longitudes):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">:::</span><span class="va">degrees_to_radians</span>
<span class="fu">stormwindmodel</span><span class="fu">:::</span><span class="va">latlon_to_km</span></code></pre></div>
<p>The package uses these functions in a function called <code>calc_forward_speed</code> that calculates the distance between two storm locations, calculates the time difference in their observation times, and from that determines the forward speed in kilometers per hour and converts it to meters per second.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">:::</span><span class="va">calc_forward_speed</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="calculate-direction-of-storm-movement">Calculate direction of storm movement<a class="anchor" aria-label="anchor" href="#calculate-direction-of-storm-movement"></a>
</h4>
<p>Next, the code calculates the direction of the motion of the storm (storm bearing). Later code will use this to add back in a component for the forward motion of the storm into the wind estimates. The following equation is used to calculate the bearing of one point from another point based on latitude and longitude. So, this is calculating the bearing of a later storm observation, as seen from an earlier storm observation. The function restricts the output to be between 0 and 360 degrees using modular arithmetic (<code>%% 360</code>).</p>
<p><span class="math display">\[
S = cos(\phi_{2,rad}) * sin(L_{1,rad} - L_{2,rad})
\]</span></p>
<p><span class="math display">\[
C = cos(\phi_{1,rad}) * sin(\phi_{2,rad}) - sin(\phi_{1,rad}) * cos(\phi_{2,rad}) * cos(L_{1,rad} - L_{2,rad})
\]</span></p>
<p><span class="math display">\[
\theta_{F} = atan2(S, C) * \frac{180}{\pi} + 90
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\phi_{1,rad}\)</span>: Latitude of first location, in radians</li>
<li>
<span class="math inline">\(L_{1,rad}\)</span>: Longitude of first location, in radians</li>
<li>
<span class="math inline">\(\phi_{2,rad}\)</span>: Latitude of second location, in radians</li>
<li>
<span class="math inline">\(L_{2,rad}\)</span>: Longitude of second location, in radians</li>
<li>
<span class="math inline">\(S\)</span>, <span class="math inline">\(C\)</span>: Intermediary results</li>
<li>
<span class="math inline">\(\theta_F\)</span> is the direction of the storm movement, in degrees</li>
</ul>
<p>The direction of storm movement (<span class="math inline">\(\theta_F\)</span>) is given in polar coordinates, with 0 degrees representing movement due East, 90 degrees due North, and so on:</p>
<p>This calculation is implemented in our package through the <code>calc_bearing</code> function:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">::</span><span class="va"><a href="../reference/calc_bearing.html">calc_bearing</a></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="calculate-u--and-v-components-of-forward-speed">Calculate u- and v-components of forward speed<a class="anchor" aria-label="anchor" href="#calculate-u--and-v-components-of-forward-speed"></a>
</h4>
<p>Next, the code uses the estimated magnitude and direction of the storm’s forward speed to calculate u- and v-components of this forward speed. Later, these two components are added back to the modeled surface wind speed at grid points, after adjusting with the Phadke correction factor for forward motion <span class="citation">(Phadke et al. 2003)</span>.</p>
<p>To calculate the u- and v-components of forward motion, <span class="math inline">\(F_{u}\)</span> and <span class="math inline">\(F_{v}\)</span>, the function uses:</p>
<p><span class="math display">\[
F_{u} = \left|\overrightarrow{F}\right| cos(\theta_F)
\]</span></p>
<p><span class="math display">\[
F_{v} = \left|\overrightarrow{F}\right| sin(\theta_F)
\]</span></p>
<p>where <span class="math inline">\(\theta_F\)</span> is the direction of the storm movement (0 for due east, 90 for due north, etc.).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tcspd_u</span> <span class="op">=</span> <span class="va">tcspd</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fu">degrees_to_radians</span><span class="op">(</span><span class="va">tcdir</span><span class="op">)</span><span class="op">)</span>
<span class="va">tcspd_v</span> <span class="op">=</span> <span class="va">tcspd</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fu">degrees_to_radians</span><span class="op">(</span><span class="va">tcdir</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="adjust-wind-speed-to-remove-forward-motion-of-storm">Adjust wind speed to remove forward motion of storm<a class="anchor" aria-label="anchor" href="#adjust-wind-speed-to-remove-forward-motion-of-storm"></a>
</h4>
<p>Next, there’s a function called <code>remove_forward_speed</code> that uses the estimated forward speed to adjust wind speed to remove the component from forward motion, based on equation 12 (and accompanying text) from Phadke et al. <span class="citation">(2003)</span>.</p>
<p>Because here the code is adjusting the maximum sustained wind to remove the component from forward speed, we can assume that we are adjusting wind speed at the radius of maximum winds and for winds blowing in the same direction as the direction of the forward motion of the storm. Therefore, the correction term for forward motion is <span class="math inline">\(U = 0.5F\)</span> <span class="citation">(Phadke et al. 2003)</span>, or half the total forward speed of the storm. This correction factor is subtracted from the maximum sustained wind speed to remove the forward component, and because we assume that the maximum winds are blowing in the same direction as the direction of the storm’s forward motion, this correction term is directly subtracted from the magnitude of the wind speed (rather than breaking into u- and v-components for a vector addition).</p>
<p>If <span class="math inline">\(V_{max}\)</span> after removing the forward storm motion is ever negative, the <code>remove_forward_speed</code> function resets the value to 0 m / s.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">:::</span><span class="va"><a href="../reference/remove_forward_speed.html">remove_forward_speed</a></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="convert-symmetric-surface-wind-to-gradient-wind">Convert symmetric surface wind to gradient wind<a class="anchor" aria-label="anchor" href="#convert-symmetric-surface-wind-to-gradient-wind"></a>
</h4>
<p>The extended tracks database gives maximum winds as 1-minute sustained wind speeds 10 meters above the ground. To make calculations easier (by not having to deal with friction), the code converts the symmetric 1-minute sustained wind speeds at 10 meters (<span class="math inline">\(V_{max,sym}\)</span>) to gradient wind speed (<span class="math inline">\(V_{max,G}\)</span>), using the following equation:</p>
<p><span class="math display">\[
V_{max,G} = \frac{V_{max,sym}}{f_r}
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(V_{max,G}\)</span>: Maximum gradient-level 1-minute sustained wind (m/s)</li>
<li>
<span class="math inline">\(V_{max,sym}\)</span>: Maximum 10-m 1-minute sustained wind with motion asymmetry removed (m/s)</li>
<li>
<span class="math inline">\(f_r\)</span>: Reduction factor for <span class="math inline">\(r \le\)</span> 100 km. At this point, the winds are calculated for <span class="math inline">\(r = R_{max}\)</span>.</li>
</ul>
<p>The code uses the reduction factor from Figure 3 of Knaff et al. <span class="citation">(2011)</span>. We assume that <span class="math inline">\(R_{max}\)</span> is always 100 km or less. Then, <span class="math inline">\(f_r\)</span> is 0.9 if the storm’s center is over water and 80% of that, 0.72, if the storm’s center is over land <span class="citation">(Knaff et al. 2011)</span>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">::</span><span class="va"><a href="../reference/calc_gradient_speed.html">calc_gradient_speed</a></span></code></pre></div>
<p>To determine if the storm center is over land or over water, the package includes a dataset called <code>landmask</code>, with locations of grid points worldwide, with a factor saying whether each point is over land or water:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">landmask</span><span class="op">)</span>
<span class="va">landmask</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></code></pre></div>
<p>The <code>check_over_land</code> function finds the closest grid point for a storm location and determines whether the storm is over land or over water at its observed location.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">:::</span><span class="va"><a href="../reference/check_over_land.html">check_over_land</a></span></code></pre></div>
<p>Here is an example of applying this function to the tracks for Hurricane Floyd:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">floyd_tracks</span><span class="op">$</span><span class="va">land</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="fu">stormwindmodel</span><span class="fu">:::</span><span class="va"><a href="../reference/check_over_land.html">check_over_land</a></span>,
                            tclat <span class="op">=</span> <span class="va">floyd_tracks</span><span class="op">$</span><span class="va">latitude</span>,
                            tclon <span class="op">=</span> <span class="va">floyd_tracks</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span>

<span class="va">landmask_df</span> <span class="op">&lt;-</span> <span class="va">landmask</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">rownames_to_column</span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">longitude</span>, names_to <span class="op">=</span> <span class="st">"latitude"</span>, values_to <span class="op">=</span> <span class="st">"land"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">longitude</span><span class="op">)</span>, 
         latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">latitude</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">landmask_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, color <span class="op">=</span> <span class="va">land</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">floyd_tracks</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, 
                                     color <span class="op">=</span> <span class="cn">NULL</span>, shape <span class="op">=</span> <span class="va">land</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_hue.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span><span class="st">"Land mask"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_shape.html" class="external-link">scale_shape_discrete</a></span><span class="op">(</span><span class="st">"Track over land"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="op">-</span><span class="fl">40</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_map</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>In the <code>add_wind_radii</code> function, there is code to check whether the point is over land or water and apply the proper reduction factor:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>over_land <span class="ot">=</span> <span class="fu">mapply</span>(check_over_land, tclat, tclon),</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>vmax_gl <span class="ot">=</span> <span class="fu">mapply</span>(calc_gradient_speed,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">vmax_sfc_sym =</span> vmax_sfc_sym,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">over_land =</span> over_land)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="calculate-radius-of-maximum-wind-speed">Calculate radius of maximum wind speed<a class="anchor" aria-label="anchor" href="#calculate-radius-of-maximum-wind-speed"></a>
</h4>
<p>Next, the package code calculates <span class="math inline">\(R_{max}\)</span>, the radius of maximum wind speed, using Eq. 7a from Willoughby et al. <span class="citation">(2006)</span>:</p>
<p><span class="math display">\[
R_{max} = 46.4 e^{- 0.0155 V_{max,G} + 0.0169 \lvert \phi \rvert}
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(R_{max}\)</span>: Radius from the storm center to the point at which the maximum wind occurs (km)</li>
<li>
<span class="math inline">\(V_{max,G}\)</span>: Maximum gradient-level 1-min sustained wind (m / s)</li>
<li>
<span class="math inline">\(\phi\)</span>: Latitude, in decimal degrees. The absolute value of this is taken, as this is a factor of how far the storm is from the equator—taking the absolute value accommodates Southern Hemisphere storms.</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">::</span><span class="va">will7a</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="calculate-parameters-for-willoughby-model">Calculate parameters for Willoughby model<a class="anchor" aria-label="anchor" href="#calculate-parameters-for-willoughby-model"></a>
</h4>
<p>Next, the code calculates <span class="math inline">\(X_1\)</span>, which is a parameter needed for the Willoughby model. This is done using equation 10a from Willoughby et al. <span class="citation">(2006)</span>:</p>
<p><span class="math display">\[
X_1 = 317.1 - 2.026V_{max,G} + 1.915 \lvert \phi \rvert
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(X_1\)</span>: Parameter for Willoughby wind model</li>
<li>
<span class="math inline">\(V_{max,G}\)</span>: Maximum gradient-level 1-min sustained wind (m / s)</li>
<li>
<span class="math inline">\(\phi\)</span>: Latitude, in decimal degrees</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">::</span><span class="va">will10a</span></code></pre></div>
<p>Next, the code calculates another Willoughby parameter, <span class="math inline">\(n\)</span>. This is done with equation 10b from Willoughby et al. <span class="citation">(2006)</span>:</p>
<p><span class="math display">\[
n = 0.4067 + 0.0144 V_{max,G} - 0.0038 \lvert \phi \rvert
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(n\)</span>: the exponential for the power law inside the eye</li>
<li>
<span class="math inline">\(V_{max,G}\)</span>: Maximum gradient-level 1-min sustained wind (m / s)</li>
<li>
<span class="math inline">\(\phi\)</span>: Latitude, in decimal degrees</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">::</span><span class="va">will10b</span></code></pre></div>
<p>Next, the code calculates another Willoughby parameter, <span class="math inline">\(A\)</span>, with equation 10c from Willoughby et al. <span class="citation">(2006)</span>:</p>
<p><span class="math display">\[
A = 0.0696 + 0.0049 V_{max,G} - 0.0064 \lvert \phi \rvert
\]</span> <span class="math display">\[
A = \begin{cases}
0 &amp; \text{ if } A &lt; 0\\ 
 A &amp; \text{ otherwise }
\end{cases}
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(A\)</span>: A parameter for the Willoughby model</li>
<li>
<span class="math inline">\(V_{max,G}\)</span>: Maximum gradient-level 1-min sustained wind (m / s)</li>
<li>
<span class="math inline">\(\phi\)</span>: Absolute value of latitude (degrees)</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">::</span><span class="va">will10c</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="determine-radius-of-start-of-transition-region">Determine radius of start of transition region<a class="anchor" aria-label="anchor" href="#determine-radius-of-start-of-transition-region"></a>
</h4>
<p>Now, the code uses a numerical method to determine the value of <span class="math inline">\(R_1\)</span>, the radius to the start of the transition region, for the storm for a given track observation. The requires finding the root of this equation <span class="citation">(Willoughby, Darling, and Rahn 2006)</span>:</p>
<p><span class="math display">\[
w - \frac{n ((1 - A) X_1 + 25 A)}{n ((1 - A) X_1 + 25 A) + R_{max}} = 0
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(w\)</span>: The weighting function (a function of <span class="math inline">\(R_{max}\)</span>, <span class="math inline">\(R_1\)</span>, and <span class="math inline">\(R_2 - R_1\)</span>; see below)</li>
<li>
<span class="math inline">\(n\)</span>: A parameter for the Willoughby model</li>
<li>
<span class="math inline">\(R_{max}\)</span>: Radius at which the maximum wind occurs (km)</li>
<li>
<span class="math inline">\(A\)</span>: A parameter for the Willoughby model</li>
<li>
<span class="math inline">\(X_1\)</span>: A parameter for the Willoughby model</li>
<li>
<span class="math inline">\(X_2\)</span>: A parameter for the Willoughby model, set to 25 <span class="citation">(Willoughby, Darling, and Rahn 2006)</span>
</li>
</ul>
<p>The weighting function, <span class="math inline">\(w\)</span>, is:</p>
<p><span class="math display">\[
w = \begin{cases}
0 &amp; \text{if } \xi &lt; 0 \\ 
126 \xi^5 - 420 \xi^6 + 540 \xi^7- 315 \xi^8 + 70 \xi^9 &amp; \text{if } 0 \le \xi \le 1\\
 1 &amp; \text{if } \xi &gt; 1
\end{cases}
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
\xi = \frac{R_{max} - R_1}{R_2 - R_1}
\]</span></p>
<p>and where:</p>
<ul>
<li>
<span class="math inline">\(w\)</span>: The weighting function</li>
<li>
<span class="math inline">\(\xi\)</span>: A nondimensional argument</li>
<li>
<span class="math inline">\(R_{max}\)</span>: radius at which the maximum wind occurs (km)</li>
<li>
<span class="math inline">\(R_1\)</span>: lower boundary of the transition zone (in km from the storm center)</li>
<li>
<span class="math inline">\(R_2\)</span>: upper boundary of the transition zone (in km from the storm center)</li>
</ul>
<p>To find the root of this equation, the package has a function that uses the Newton-Raphson method <span class="citation">(Press et al. 2002; Jones, Maillardet, and Robinson 2009)</span>. This function starts with an initial guess of the root, <span class="math inline">\(x_0\)</span>, then calculates new values of <span class="math inline">\(x_{n+1}\)</span> using:</p>
<p><span class="math display">\[
x_{n+1} = x_n - \frac{f(x_n)}{f'(x_n)}
\]</span></p>
<p>This process iterates until either the absolute value of <span class="math inline">\(f(x_{n+1})\)</span> is smaller than some threshold (<span class="math inline">\(\epsilon\)</span>; default of 0.001 in our function) or the maximum allowed number of iterations is reached (default of 100 iterations in our function).</p>
<p>In this case, we’re using it to try to find the value of <span class="math inline">\(\xi\)</span> that is a root of the following function:</p>
<p><span class="math display">\[
f(\xi) = 126 \xi^5 - 420 \xi^6 + 540 \xi^7- 315 \xi^8 + 70 \xi^9 - \frac{n ((1 - A) X_1 + 25 A)}{n ((1 - A) X_1 + 25 A) + R_{max}}
\]</span></p>
<p>The derivative of this function, which is also needed for the Newton-Raphson method, is:</p>
<p><span class="math display">\[
f'(\xi) = 5 * 126 \xi^4 - 6 * 420 \xi^5 + 7 * 540 \xi^6 - 8 * 315 \xi^7 + 9 * 70 \xi^8 
\]</span></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">::</span><span class="va">will3_right</span>
<span class="fu">stormwindmodel</span><span class="fu">::</span><span class="va"><a href="../reference/will3_deriv_func.html">will3_deriv_func</a></span>
<span class="fu">stormwindmodel</span><span class="fu">::</span><span class="va"><a href="../reference/solve_for_xi.html">solve_for_xi</a></span></code></pre></div>
<p>While the Newton-Raphson method can sometimes perform poorly in finding global maxima, in this case the function for which we are trying to find the root is well-behaved. Across tropical storms from 1988 to 2015, the method never failed to converge, and identified roots were consistent across storms (typically roots are for <span class="math inline">\(\xi\)</span> of 0.6–0.65). We also tested using the <code>optim</code> function in the <code>stats</code> R package and found similar estimated roots but slower convergence times than when using the Newton-Raphson method.</p>
<p>Now an equation from the Willoughby et al. 2006 paper can be used to calculate <span class="math inline">\(R_1\)</span> <span class="citation">(Willoughby, Darling, and Rahn 2006)</span>:</p>
<p><span class="math display">\[
R_1 = R_{max} - \xi(R_2 - R_1)
\]</span></p>
<p>For this function, the package code assumes that <span class="math inline">\(R_2 - R_1\)</span> (the width of the transition region) is 25 kilometers when <span class="math inline">\(R_{max}\)</span> is larger than 20 kilometers and 15 kilometers otherwise.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">::</span><span class="va">calc_R1</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="determine-radius-for-end-of-transition-region">Determine radius for end of transition region<a class="anchor" aria-label="anchor" href="#determine-radius-for-end-of-transition-region"></a>
</h4>
<p>Next, the code estimates the radius for the end of the transition period, <span class="math inline">\(R_2\)</span>. We assume that smaller storms (<span class="math inline">\(R_{max} \le 20\mbox{ km}\)</span>) have a transition region of 15 km while larger storms (<span class="math inline">\(R_{max} &gt; 20\mbox{ km}\)</span>) have a transition region of 25 km:</p>
<p><span class="math display">\[
R_2 = \begin{cases}
R_1 + 25 &amp; \text{ if } R_{max} &gt; 20\mbox{ km}\\ 
R_1 + 15 &amp; \text{ if } R_{max} \le 20\mbox{ km}
\end{cases}
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(R_1\)</span>: Radius to the start of the transition region (km)</li>
<li>
<span class="math inline">\(R_2\)</span>: Radius to the end of the transition region (km)</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">R2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Rmax</span> <span class="op">&gt;</span> <span class="fl">20</span>, <span class="va">R1</span> <span class="op">+</span> <span class="fl">25</span>, <span class="va">R1</span> <span class="op">+</span> <span class="fl">15</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="calculate-wind-speed-at-each-grid-point">Calculate wind speed at each grid point<a class="anchor" aria-label="anchor" href="#calculate-wind-speed-at-each-grid-point"></a>
</h3>
<p>Next, the code models the wind speed at a location (e.g., a county center). As a note, this function calculates wind characteristics at a single location; a later function applies this function across many grid points):</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">::</span><span class="va"><a href="../reference/calc_grid_wind.html">calc_grid_wind</a></span></code></pre></div>
<p>Again, this function uses a lot of helper functions for each step. As an input, this function requires both the dataframe output from <code>add_wind_radii</code> (which gives all of the parameters for the Willoughby model at each point on the storm’s track) and also a location (latitude and longitude) at which to model winds. To work well with later functions, this location information should be input as a one-row dataframe rather than a vector. The <code>grid_point</code> input might therefore look something like this:</p>
<p>The package includes a dataset called <code>county_points</code> that has the population mean centers of each county in hurricane-prone states. This dataset can be used directly from the package to determine county-level exposures.</p>
<p>The <code>grid_point</code> input must follow a specific format. The column names for latitude and longitude must be <code>glat</code> and <code>glon</code>, both should be in decimal degrees, in degrees East for the longitude (so, negative values in the Western hemisphere) and degrees North for the latitude.</p>
<p>Here is an example of running the <code>calc_grid_wind</code> function, as well as the typical output from the function. Notice that the function only outputs wind estimates for one grid point at a time; in this example, the point is for Dare County, NC, (FIPS 37055) during Hurricane Floyd:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grid_point</span> <span class="op">&lt;-</span> <span class="va">county_points</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">gridid</span> <span class="op">==</span> <span class="st">"37055"</span><span class="op">)</span>
<span class="va">grid_wind</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_grid_wind.html">calc_grid_wind</a></span><span class="op">(</span>grid_point <span class="op">=</span> <span class="va">grid_point</span>,
                            with_wind_radii <span class="op">=</span> <span class="va">with_wind_radii</span><span class="op">)</span>
<span class="va">grid_wind</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<p>Here is a plot of modeled sustained surface winds in Dare County by time:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">grid_wind</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">windspeed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Observation time (UTC)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Modeled surface wind (m / s)"</span><span class="op">)</span></code></pre></div>
<p>You can also apply this function across all grid points for all storm observations to create a large dataset with the estimated wind speed at each county at each observation point. For example, you could run this for Floyd and then plot winds at particular time “snap shots” using the following code:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">county_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">county_points</span>, f <span class="op">=</span> <span class="va">county_points</span><span class="op">$</span><span class="va">gridid</span><span class="op">)</span>
<span class="va">county_winds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">county_list</span>, FUN <span class="op">=</span> <span class="va">calc_grid_wind</span>,
                       with_wind_radii <span class="op">=</span> <span class="va">with_wind_radii</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">county_winds</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">county_points</span><span class="op">$</span><span class="va">gridid</span>
<span class="va">county_winds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">county_winds</span>, .id <span class="op">=</span> <span class="st">"gridid"</span><span class="op">)</span>

<span class="va">county_winds</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">==</span> <span class="st">"1999-09-16 08:00:00 UTC"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/map_wind.html">map_wind</a></span><span class="op">(</span>value <span class="op">=</span> <span class="st">"windspeed"</span><span class="op">)</span></code></pre></div>
<p>After calculating the grid wind time series for a grid point, you can input the time series for a grid point into <code>summarize_grid_wind</code> to generate overall storm summaries for the grid point. This functions calculate wind characteristics at each grid point (or county center location) for every storm observation. These characteristics are:</p>
<ul>
<li>
<code>vmax_gust</code>: Maximum value of surface-level (10 meters) sustained winds, in meters per second, over the length of the storm at the given location</li>
<li>
<code>vmax_sust</code>: Maximum value of surface-level (10 meters) gust winds, in meters per second, over the length of the storm at the given location</li>
<li>
<code>gust_dur</code>: Length of time, in minutes, that surface-level sustained winds were above a certain wind speed cutoff (e.g., 20 meters per second)</li>
<li>
<code>sust_dur</code>: Length of time, in minutes, that surface-level gust winds were above a certain wind speed cutoff (e.g., 20 meters per second)</li>
</ul>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">::</span><span class="va"><a href="../reference/summarize_grid_wind.html">summarize_grid_wind</a></span></code></pre></div>
<p>This function inputs the grid wind time series for a grid point and outputs the summary statistics for that grid point:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/summarize_grid_wind.html">summarize_grid_wind</a></span><span class="op">(</span>grid_wind <span class="op">=</span> <span class="va">grid_wind</span><span class="op">)</span></code></pre></div>
<p>If you want, you can change the wind speed cutoffs for the duration measurements:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/summarize_grid_wind.html">summarize_grid_wind</a></span><span class="op">(</span>grid_wind <span class="op">=</span> <span class="va">grid_wind</span>, gust_duration_cut <span class="op">=</span> <span class="fl">15</span>, 
                    sust_duration_cut <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></code></pre></div>
<p>The function <code>calc_and_summarize_grid_wind</code> combines these two actions (this is mainly useful to have for the main wrapper function for the package):</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/calc_and_summarize_grid_wind.html">calc_and_summarize_grid_wind</a></span><span class="op">(</span>grid_point <span class="op">=</span> <span class="va">grid_point</span>, 
                             with_wind_radii <span class="op">=</span> <span class="va">with_wind_radii</span>,
                             gust_duration_cut <span class="op">=</span> <span class="fl">15</span>, 
                             sust_duration_cut <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></code></pre></div>
<p>The <code>calc_grid_wind</code> function uses a number of helper functions. They are described in more detail below.</p>
<div class="section level4">
<h4 id="get-the-radius-from-the-storm-center-to-the-grid-point">Get the radius from the storm center to the grid point<a class="anchor" aria-label="anchor" href="#get-the-radius-from-the-storm-center-to-the-grid-point"></a>
</h4>
<p>The first step is to determine the distance between the grid point and the center of the storm (<span class="math inline">\(C_{dist}\)</span>). This is done using the Haversine method of great circle distance to calculate this distance. For this, the package uses the <code>latlon_to_km</code> function given in the code shown earlier.</p>
</div>
<div class="section level4">
<h4 id="determine-gradient-wind-speed-at-each-location">Determine gradient wind speed at each location<a class="anchor" aria-label="anchor" href="#determine-gradient-wind-speed-at-each-location"></a>
</h4>
<p>Next, the package calculates <span class="math inline">\(V_G(r)\)</span>, the gradient level 1-minute sustained wind at the grid point, which is at radius <span class="math inline">\(r\)</span> from the tropical cyclone center (<span class="math inline">\(C_{dist}\)</span> for the grid point). Note there are different equations for <span class="math inline">\(V_G(r)\)</span> for (1) the eye to the start of the transition region; (2) outside the transition region; and (3) within the transition region.</p>
<p>First, if <span class="math inline">\(r \le R_1\)</span> (inside the transition region), <span class="math inline">\(V_G(r)\)</span> is calculated using <span class="citation">(equation 1a, Willoughby, Darling, and Rahn 2006)</span>:</p>
<p><span class="math display">\[
V_G(r) = V_i = V_{max,G} \left( \frac{r}{R_{max}} \right)^n, (0 \le r \le R_1)
\]</span></p>
<p>Next, if <span class="math inline">\(r \ge R_2\)</span> (outside the transition region), <span class="math inline">\(V_G(r)\)</span> is calculated using <span class="citation">(equation 4, dual-exponential replacement of equation 1b, Willoughby, Darling, and Rahn 2006)</span>:</p>
<p><span class="math display">\[
V_G(r) = V_o = V_{max,G}\left[(1 - A) e^\frac{R_{max} - r}{X_1} + A e^\frac{R_{max} - r}{X_2}\right], R_2 &lt; r
\]</span></p>
<p>Finally, if <span class="math inline">\(r\)</span> is between <span class="math inline">\(R_1\)</span> and <span class="math inline">\(R_2\)</span>, first <span class="math inline">\(\xi\)</span> must be calculated for the grid point <span class="citation">(Willoughby, Darling, and Rahn 2006)</span>:</p>
<p><span class="math display">\[
\xi = \frac{r - R_1}{R_2 - R_1}
\]</span></p>
<p>and then:</p>
<p><span class="math display">\[
w = \begin{cases}
0 &amp; \text{if } \xi \le 0 \\ 
126 \xi^5 - 420 \xi^6 + 540 \xi^7- 315 \xi^8 + 70 \xi^9 &amp; \text{if } 0 &lt; \xi , 1\\
 1 &amp; \text{if } \xi \ge 1
\end{cases}
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(w\)</span>: Weighting variable</li>
<li>
<span class="math inline">\(\xi\)</span>: A nondimensional argument</li>
<li>
<span class="math inline">\(r\)</span>: radius from the storm center to the grid point (in km)</li>
<li>
<span class="math inline">\(R_{max}\)</span>: radius at which the maximum wind occurs (km)</li>
<li>
<span class="math inline">\(R_1\)</span>: lower boundary of the transition zone (in km from the storm center)</li>
<li>
<span class="math inline">\(R_2\)</span>: upper boundary of the transition zone (in km from the storm center)</li>
</ul>
<p>The, <span class="math inline">\(V(r)\)</span> is calculated using <span class="citation">(equation 1c, Willoughby, Darling, and Rahn 2006)</span>:</p>
<p><span class="math display">\[
V_G(r) = V_i (1 - w) + V_o w, (R_1 \le r \le R_2)
\]</span></p>
<p>All of this is wrapped in a function:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">:::</span><span class="va">will1</span></code></pre></div>
<p>which includes several helper functions:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">::</span><span class="va">will1a</span>
<span class="fu">stormwindmodel</span><span class="fu">:::</span><span class="va">will4</span>
<span class="fu">stormwindmodel</span><span class="fu">::</span><span class="va">will2</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="estimate-surface-level-winds-from-gradient-winds">Estimate surface level winds from gradient winds<a class="anchor" aria-label="anchor" href="#estimate-surface-level-winds-from-gradient-winds"></a>
</h4>
<p>Now, to get estimated symmetric surface-level tangential winds from gradient-levels winds, the code uses a method from Knaff et al. <span class="citation">(2011)</span>.</p>
<p>In this case, we can always assume the point is over land, not water, since we are modeling exposure among humans. Therefore, the code always uses a reduction factor that is reduced by 20%. This method uses a reduction factor of 0.90 up to a radius of 100 km, a reduction factor of 0.75 for any radius 700 km or greater, and a linear decreasing reduction factor for any radius between those two radius values <span class="citation">(Knaff et al. 2011)</span>. If the point is over land (true for any county and almost any residence), this reduction factor is further reduced by 20%.</p>
<p>Here is the function the code uses for this part:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">:::</span><span class="va"><a href="../reference/gradient_to_surface.html">gradient_to_surface</a></span></code></pre></div>
<p>Here is a reproduction of part of Figure 3 from Knaff et al. <span class="citation">(2011)</span> using this function:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rf_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>r <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">800</span>,
                         rf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span>
                           <span class="fu">stormwindmodel</span><span class="fu">:::</span><span class="va"><a href="../reference/gradient_to_surface.html">gradient_to_surface</a></span>, 
                           wind_gl_aa <span class="op">=</span> <span class="fl">1</span>, cdist <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">800</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rf_example</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">r</span>, y <span class="op">=</span> <span class="va">rf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Radius (km)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Reduction factor"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="calculate-the-direction-of-gradient-winds-at-each-location">Calculate the direction of gradient winds at each location<a class="anchor" aria-label="anchor" href="#calculate-the-direction-of-gradient-winds-at-each-location"></a>
</h4>
<p>So far, the model has just calculated the the rotational component of the wind speed at each grid location (tangential wind). Now the code adds back asymmetry from the forward motion component of the wind speed (translational wind) at each location. The total storm winds will be increased by forward motion of the storm on the right side of the storm in the Northern Hemisphere and the left side of the storm in the Southern Hemisphere. Conversely, on the opposite side of the storm, the forward motion of the storm will offset some of the storm-related wind.</p>
<p>We’ve already determined the direction of the forward direction of the storm. Now, we need to get the direction of the storm winds at the grid point location.</p>
<p>First, a function determines, for each storm location, the direction from the storm center to the location. For this, the package uses the <code>calc_bearing</code> function described earlier to determine the bearing of the storm at each storm observation. Now, it is used to calculate the angle from the storm center to the grid point:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">:::</span><span class="va"><a href="../reference/calc_bearing.html">calc_bearing</a></span></code></pre></div>
<p>Next, a function calculates the gradient wind direction based on the bearing of a location from the storm. This gradient wind direction is calculated by adding 90 degrees to the bearing of the grid point from the storm center in the Northern Hemisphere and subtracting 90 degrees in the Southern Hemisphere. The direction is constrained to be between 0 and 360 degrees and is in polar coordinates (0 degrees is due East, 90 degrees is due North, etc.).</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">:::</span><span class="va"><a href="../reference/calc_gwd.html">calc_gwd</a></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="calculate-the-surface-wind-direction">Calculate the surface wind direction<a class="anchor" aria-label="anchor" href="#calculate-the-surface-wind-direction"></a>
</h4>
<p>The next step is to change from the gradient wind direction to the surface wind direction. To do this, the function adds an inflow angle to the gradient wind direction in the Northern Hemisphere and subtracts an inflow angle in the Southern Hemisphere (making sure the final answer is between 0 and 360 degrees). This step is necessary because surface friction changes the wind direction near the surface compared to higher above the surface, making the wind direction turn in towards the center of the storm.</p>
<p>The inflow angle is calculated as a function of the distance from the storm center to the location and the storm’s <span class="math inline">\(R_{max}\)</span> at that observation point <span class="citation">(eq. 11a–c, Phadke et al. 2003)</span>:</p>
<p><span class="math display">\[
\beta = \begin{cases}
 &amp; 10 + \left(1 + \frac{r}{R_{max}}\right) \text{ if } r &lt; R_{max}\\ 
 &amp; 20 + 25\left(\frac{r}{R_{max}} - 1 \right ) \text{ if } R_{max} \le r \le 1.2R_{max}\\ 
 &amp; 25 \text{ if } r \ge 1.2R_{max}
\end{cases}
\]</span></p>
<p>Over land, the inflow angle should be about 20 degrees more than it is over water. Therefore, after calculating the inflow angle from the equation above, the function adds 20 degrees to the value since all modeled locations are over land. The final calculation, then, is, for the Northern Hemisphere:</p>
<p><span class="math display">\[
\theta_S = \theta_G + \beta + 20
\]</span></p>
<p>and for the Southern Hemisphere:</p>
<p><span class="math display">\[
\theta_S = \theta_G - \beta - 20
\]</span></p>
<p>Here is the function for this step:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">add_inflow</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="add-back-in-wind-component-from-forward-speed-of-storm">Add back in wind component from forward speed of storm<a class="anchor" aria-label="anchor" href="#add-back-in-wind-component-from-forward-speed-of-storm"></a>
</h4>
<p>Next, to add back in the storm’s forward motion at each grid point, the code reverses the earlier step that used the Phadke correction factor <span class="citation">(equation 12, Phadke et al. 2003)</span>. The package calculates a constant correction factor (<code>correction_factor</code>), as a function of <code>r</code>, radius from the storm center to the grid point, and <span class="math inline">\(R_{max}\)</span>, radius from storm center to maximum winds.</p>
<p><span class="math display">\[
U(r) = \frac{R_{max}r}{R_{max}^2 + r^2}F
\]</span> where:</p>
<ul>
<li>
<span class="math inline">\(U(r)\)</span>: Phadke correction factor at a radius <span class="math inline">\(r\)</span> from the storm’s center</li>
<li>
<span class="math inline">\(r\)</span>: Radius from the storm’s center (km)</li>
<li>
<span class="math inline">\(R_{max}\)</span>: Radius of maximum winds (km)</li>
<li>
<span class="math inline">\(F\)</span>: Forward speed of the storm (m / s)</li>
</ul>
<p>Both the u- and v-components of forward speed are corrected with this correction factor, then these components are added to the u- and v-components of tangential surface wind. These u- and v-components are then used to calculate the magnitude of total wind associated with the storm at the grid point:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">:::</span><span class="va"><a href="../reference/add_forward_speed.html">add_forward_speed</a></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="calculate-3-second-gust-wind-speed-from-sustained-wind-speed">Calculate 3-second gust wind speed from sustained wind speed<a class="anchor" aria-label="anchor" href="#calculate-3-second-gust-wind-speed-from-sustained-wind-speed"></a>
</h4>
<p>The last step in the code calculates gust wind speed from sustained wind speed by applying a gust factor:</p>
<p><span class="math display">\[
V_{sfc,gust} = G_{3,60}*V_{sfc}
\]</span></p>
<p>where <span class="math inline">\(V_{sfc}\)</span> is the asymmetric surface wind speed, <span class="math inline">\(V_{sfc,gust}\)</span> is the surface gust wind speed, and <span class="math inline">\(G_{3,60}\)</span> is the gust factor.</p>
<p>Here is a table with gust factors based on location <span class="citation">(Harper, Kepert, and Ginger 2010)</span>:</p>
<p>The <code>stormwindmodel</code> package uses the “in-land” gust factor value throughout.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gustspeed</span> <span class="op">=</span> <span class="va">windspeed</span> <span class="op">*</span> <span class="fl">1.49</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="putting-everything-together">Putting everything together<a class="anchor" aria-label="anchor" href="#putting-everything-together"></a>
</h3>
<p>There’s a wrapper function called <code>get_grid_winds</code> that puts everything together. As inputs, it takes the storm tracks and the grid point locations. Here is what the start of that dataset looks like:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"katrina_tracks"</span><span class="op">)</span>
<span class="va">grid_winds_katrina</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_grid_winds.html">get_grid_winds</a></span><span class="op">(</span>hurr_track <span class="op">=</span> <span class="va">katrina_tracks</span>,
                                     grid_df <span class="op">=</span> <span class="va">county_points</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">grid_winds_katrina</span>, file <span class="op">=</span> <span class="st">"data/grid_winds_katrina.Rdata"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"data/grid_winds_katrina.Rdata"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">grid_winds_katrina</span><span class="op">)</span></code></pre></div>
<p>with the maximum sustained and gust wind speeds (in meters per second) and duration of winds over 20 meters per second for each wind type (this cutoff point can be customized with the <code>gust_duration</code> and <code>sust_duration</code> arguments) added for each grid point.</p>
<p>Here is the code for this function:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stormwindmodel</span><span class="fu">::</span><span class="va"><a href="../reference/get_grid_winds.html">get_grid_winds</a></span></code></pre></div>
<p>There is also a function to map county-level estimates. For this function to work, winds must be modeled at county centers, with FIPS codes used as the grid ids. Here’s an example of calculating and mapping county winds for Katrina:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grid_winds_katrina</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_grid_winds.html">get_grid_winds</a></span><span class="op">(</span>hurr_track <span class="op">=</span> <span class="va">katrina_tracks</span>,
                                     grid_df <span class="op">=</span> <span class="va">county_points</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">katrina_winds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_wind.html">map_wind</a></span><span class="op">(</span><span class="va">grid_winds_katrina</span>, value <span class="op">=</span> <span class="st">"vmax_gust"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Maximum gust wind speeds"</span><span class="op">)</span>
<span class="fu"><a href="../reference/add_storm_track.html">add_storm_track</a></span><span class="op">(</span><span class="va">katrina_tracks</span>, plot_object <span class="op">=</span> <span class="va">katrina_winds</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">katrina_winds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_wind.html">map_wind</a></span><span class="op">(</span><span class="va">grid_winds_katrina</span>, value <span class="op">=</span> <span class="st">"vmax_sust"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Maximum sustained wind speeds"</span><span class="op">)</span>
<span class="fu"><a href="../reference/add_storm_track.html">add_storm_track</a></span><span class="op">(</span><span class="va">katrina_tracks</span>, plot_object <span class="op">=</span> <span class="va">katrina_winds</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Show in knots</span>
<span class="va">katrina_winds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_wind.html">map_wind</a></span><span class="op">(</span><span class="va">grid_winds_katrina</span>, value <span class="op">=</span> <span class="st">"vmax_gust"</span>,
              wind_metric <span class="op">=</span> <span class="st">"knots"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Maximum gust wind speeds"</span><span class="op">)</span>
<span class="fu"><a href="../reference/add_storm_track.html">add_storm_track</a></span><span class="op">(</span><span class="va">katrina_tracks</span>, plot_object <span class="op">=</span> <span class="va">katrina_winds</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">katrina_winds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_wind.html">map_wind</a></span><span class="op">(</span><span class="va">grid_winds_katrina</span>, value <span class="op">=</span> <span class="st">"vmax_sust"</span>,
              wind_metric <span class="op">=</span> <span class="st">"knots"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Maximum sustained wind speeds"</span><span class="op">)</span>
<span class="fu"><a href="../reference/add_storm_track.html">add_storm_track</a></span><span class="op">(</span><span class="va">katrina_tracks</span>, plot_object <span class="op">=</span> <span class="va">katrina_winds</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sustained winds of 20 m / s or more</span>
<span class="va">katrina_winds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_wind.html">map_wind</a></span><span class="op">(</span><span class="va">grid_winds_katrina</span>, value <span class="op">=</span> <span class="st">"vmax_sust"</span>, 
         break_point <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="fu"><a href="../reference/add_storm_track.html">add_storm_track</a></span><span class="op">(</span><span class="va">katrina_tracks</span>, plot_object <span class="op">=</span> <span class="va">katrina_winds</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sustained winds of 34 knots or more</span>
<span class="va">katrina_winds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_wind.html">map_wind</a></span><span class="op">(</span><span class="va">grid_winds_katrina</span>, value <span class="op">=</span> <span class="st">"vmax_sust"</span>,
                          wind_metric <span class="op">=</span> <span class="st">"knots"</span>, break_point <span class="op">=</span> <span class="fl">34</span><span class="op">)</span>
<span class="fu"><a href="../reference/add_storm_track.html">add_storm_track</a></span><span class="op">(</span><span class="va">katrina_tracks</span>, plot_object <span class="op">=</span> <span class="va">katrina_winds</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sustained winds of 50 knots or more</span>
<span class="va">katrina_winds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_wind.html">map_wind</a></span><span class="op">(</span><span class="va">grid_winds_katrina</span>, value <span class="op">=</span> <span class="st">"vmax_sust"</span>,
                          wind_metric <span class="op">=</span> <span class="st">"knots"</span>, break_point <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
<span class="fu"><a href="../reference/add_storm_track.html">add_storm_track</a></span><span class="op">(</span><span class="va">katrina_tracks</span>, plot_object <span class="op">=</span> <span class="va">katrina_winds</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sustained winds of 64 knots or more</span>
<span class="va">katrina_winds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_wind.html">map_wind</a></span><span class="op">(</span><span class="va">grid_winds_katrina</span>, value <span class="op">=</span> <span class="st">"vmax_sust"</span>,
                          wind_metric <span class="op">=</span> <span class="st">"knots"</span>,  break_point <span class="op">=</span> <span class="fl">64</span><span class="op">)</span>
<span class="fu"><a href="../reference/add_storm_track.html">add_storm_track</a></span><span class="op">(</span><span class="va">katrina_tracks</span>, plot_object <span class="op">=</span> <span class="va">katrina_winds</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-harper2010guidelines" class="csl-entry">
Harper, BA, JD Kepert, and JD Ginger. 2010. <span>“Guidelines for Converting Between Various Wind Averaging Periods in Tropical Cyclone Conditions.”</span> <em>World Meteorological Organization, WMO/TD</em> 1555.
</div>
<div id="ref-jones2014introduction" class="csl-entry">
Jones, Owen, Robert Maillardet, and Andrew Robinson. 2009. <em>Introduction to Scientific Programming and Simulation Using r</em>. Boca Raton, FL: Chapman &amp; Hall/CRC Press.
</div>
<div id="ref-knaff2011automated" class="csl-entry">
Knaff, John A, Mark DeMaria, Debra A Molenar, Charles R Sampson, and Matthew G Seybold. 2011. <span>“An Automated, Objective, Multiple-Satellite-Platform Tropical Cyclone Surface Wind Analysis.”</span> <em>Journal of Applied Meteorology and Climatology</em> 50 (10): 2149–66.
</div>
<div id="ref-phadke2003modeling" class="csl-entry">
Phadke, Amal C, Christopher D Martino, Kwok Fai Cheung, and Samuel H Houston. 2003. <span>“Modeling of Tropical Cyclone Winds and Waves for Emergency Management.”</span> <em>Ocean Engineering</em> 30 (4): 553–78.
</div>
<div id="ref-press2002numerical" class="csl-entry">
Press, William H, Saul A Teukolsky, William T Vetterling, and Brian P Flannery. 2002. <em>Numerical Recipes in c++: The Art of Scientific Computing</em>. 2nd ed. Cambridge, UK: Cambridge University Press.
</div>
<div id="ref-willoughby2006parametric" class="csl-entry">
Willoughby, HE, RWR Darling, and ME Rahn. 2006. <span>“Parametric Representation of the Primary Hurricane Vortex. <span>Part II</span>: A New Family of Sectionally Continuous Profiles.”</span> <em>Monthly Weather Review</em> 134 (4): 1102–20.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Brooke Anderson, Andrea Schumacher, Seth Guikema, Steven Quiring, Joshua Ferreri, Elizabeth Tennant.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
